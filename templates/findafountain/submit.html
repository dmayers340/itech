{% extends 'findafountain/base.html' %}
{% load staticfiles %}

{% block titleblock %}Submit{% endblock %}

{% block title %}
  <h1>Submit</h1>
{% endblock %}

{% block content %} 

<meta name="viewport" content="initial-scale=1.0, user-scalable=no"> 

<style>
	img {
		display: block;
		margin-left: auto;
		margin-right: auto;
	}

	#map {
		   width: 100%;
		   height: 500px;
	}
</style>

<div>
	{% if user.is_authenticated %}
		<b style="font-size:25px">Please go ahead and submit your fountain.</b>

		<br/>

		<b style="font-size:18px"> Drag the marker to the location of the fountain. </b>

		<br/> 

			<input id="latitude" type="text" name="mail" size="40" placeholder="Latitude" style="margin:0 0 15px 0"><br/>
			<input id="longitude" type="text" name="mail" size="40" placeholder="Longitude" style="margin:0 0 15px 0">
			
			<form id = "fountain_form" method="post" action="{% url 'submit' %}" enctype="multipart/form-data">
			{% csrf_token %}
			{{ fountain_form.as_p }}
			<input type="submit" name="submit" value="Submit" />
			</form>

		<br/><br/>

		<div id="map" div style="max-height: 600px">

			  <script type="text/javascript">

				var map, marker; 
				var position, currentLatitude, currentLongitude;
				var campus;

				// initialises a new map 
				function initMap() {
					map = new google.maps.Map(document.getElementById('map'), {
					  zoom: 17,
					  mapTypeId: google.maps.MapTypeId.ROADMAP,
					});

					campus  = new google.maps.LatLng(55.872084,-4.288222);
					map.setCenter(campus);

					marker = new google.maps.Marker({
						map: map, 
						position: campus,
						visible: true, 
						draggable: true
					}); 

					google.maps.event.addListener(marker, 'dragend', function(marker){
						position = marker.latLng; 
						currentLatitude = position.lat();
						currentLongitude = position.lng();
						console.log(currentLatitude, currentLongitude);
						document.getElementById("latitude").value=currentLatitude;
						document.getElementById("longitude").value=currentLongitude;
					 });
				}

			  </script>

			  <!-- API key 
			  DO NOT REMOVE no matter what -->
			   <script async defer
				src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALaN1AQdFvEnlLyNLdHUmYKSjX5C82B4I&callback=initMap">
			   </script>

		</div>

	{% else %}
		<b style="font-size:25px">In order to submit a fountain, you're going to have to login first!</b>
		<p><b style="font-size:25px">Login<a href= "{% url 'register' %}"> Here</a></b></p>
		<div>
		<img src="{% static 'img/trevi.jpg' %}" alt="Image of the Trevi Fountain"/>
		</div>
	{% endif %}
</div>

{% endblock %}
